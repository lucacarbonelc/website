"use strict";(self.webpackChunkESMira=self.webpackChunkESMira||[]).push([[8778],{8778:(t,e,n)=>{n.r(e),n.d(e,{AdminTools:()=>J});var r,o=n(8819),i=n(4313),s=n(6002),a=n(3327),u=(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=function(t){function e(e,n,r,o){var i,s=this,a=null!==(i=null!=o?o:null==n?void 0:n.currentLangCode.get())&&void 0!==i?i:"en",u=e;for(var c in(s=t.call(this,u[a],n,r,o)||this).serverName=s.translatable("serverName",""),s.impressum=s.translatable("impressum",""),s.privacyPolicy=s.translatable("privacyPolicy",""),s.homeMessage=s.translatable("homeMessage",""),u)c!=a&&s.addLanguage(c,u[c]);return s}return u(e,t),e}(a.d),l=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(e,n){void 0===n&&(n=e.defaultLang);var r=t.call(this,e,null,"serverSettings",n)||this;return r.defaultLang=r.primitive("defaultLang","en"),r.langCodes=r.primitiveArray("langCodes",[]),r.siteTranslations=r.object("translationData",c),r}return l(e,t),e}(a.d),h=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},p=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},d=function(){function t(){}return t.prototype.init=function(){return h(this,void 0,void 0,(function(){var t=this;return p(this,(function(e){switch(e.label){case 0:return[4,i.o.get("serverConfigs",(function(){return h(t,void 0,void 0,(function(){var t;return p(this,(function(e){switch(e.label){case 0:return[4,s.l.loadJson("".concat(o.Zv,"?type=GetServerConfig"))];case 1:return t=e.sent(),this.settings=new f(t),[2]}}))}))}))];case 1:return e.sent(),[2,this]}}))}))},t.prototype.getSettings=function(){return this.settings},t.prototype.saveSettings=function(){return h(this,void 0,void 0,(function(){var t,e,n,r,i,a,u,c,l;return p(this,(function(h){switch(h.label){case 0:if(null==(t=this.settings))return[2,Promise.resolve()];for(e={},n=t.langCodes.get(),r=t.currentLangCode.get(),i=0,a=n;i<a.length;i++)u=a[i],t.currentLangCode.set(u.get()),e[u.get()]=t.siteTranslations.createJson({dontFilterDefaults:!0,dontIncludeAllLanguages:!0});return t.currentLangCode.set(r),(c=t.createJson({dontFilterDefaults:!0})).translationData=e,[4,s.l.loadJson(o.Zv+"?type=SaveServerConfigs","post",JSON.stringify(c))];case 1:return l=h.sent(),this.settings=new f(l,t.defaultLang.get()),this.settings.importObserverData(t),this.settings.currentLangCode.set(t.currentLangCode.get()),this.settings.hasMutated(),document.getElementById("headerServerName").innerText=this.settings.siteTranslations.serverName.get(),[2]}}))}))},t}(),g=n(335),v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y=function(t){function e(e,n,r,o){void 0===n&&(n=null);var i=t.call(this,e,n,e.accountName,o)||this;return i.accountName=i.primitive("accountName",""),i.admin=i.primitive("admin",!1),i.create=i.primitive("create",!1),i.read=i.primitiveArray("read",[]),i.write=i.primitiveArray("write",[]),i.msg=i.primitiveArray("msg",[]),i.publish=i.primitiveArray("publish",[]),i}return v(e,t),e.prototype.updateKeyName=function(e,n){t.prototype.updateKeyName.call(this,this.accountName.get(),n)},e}(a.d),w=n(3379),m=n(9700),b=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},k=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},L=function(){function t(){}return t.prototype.init=function(){return b(this,void 0,void 0,(function(){var t=this;return k(this,(function(e){return[2,i.o.get("accountsList",(function(){return b(t,void 0,void 0,(function(){var t;return k(this,(function(e){switch(e.label){case 0:return[4,s.l.loadJson("".concat(o.Zv,"?type=ListAccounts"))];case 1:return t=e.sent(),this.accounts=new g.X(t,null,"accountList",(function(t,e,n){return new y(t,e,n)})),[2,this]}}))}))}))]}))}))},t.prototype.getAccounts=function(){return this.accounts.get()},t.prototype.addAccount=function(t,e){return b(this,void 0,void 0,(function(){var n,r;return k(this,(function(i){switch(i.label){case 0:return n=this.accounts,[4,s.l.loadJson("".concat(o.Zv,"?type=CreateAccount"),"post","new_account=".concat(t,"&pass=").concat(e))];case 1:return r=i.sent(),n.push(r),[2,n.get().length-1]}}))}))},t.prototype.deleteAccount=function(t,e){return b(this,void 0,void 0,(function(){var n,r;return k(this,(function(i){switch(i.label){case 0:return n=t.accountName.get(),(0,w.gB)(m.J.get("confirm_delete_account",n))?(r=this.accounts,[4,s.l.loadJson("".concat(o.Zv,"?type=DeleteAccount"),"post","accountName=".concat(n))]):[2,!1];case 1:return i.sent(),r.remove(e),[2,!0]}}))}))},t}(),M=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=e.primitive("name",""),e.lastMsg=e.primitive("lastMsg",0),e.archived=e.primitive("archived",!1),e.pending=e.primitive("pending",!1),e.unread=e.primitive("unread",!1),e}return M(e,t),e}(a.d),N=n(3087),P=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},C=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},O=function(){function t(t){if(this.messageParticipantInfoLists={},this.studiesWithNewMessagesCount=new N.H(0,null,"studiesWithNewMessagesCount"),this.studiesWithNewMessagesList={},t.newMessages){for(var e=0,n=t.newMessages;e<n.length;e++){var r=n[e];this.studiesWithNewMessagesList[r]=!0}this.studiesWithNewMessagesCount.set(t.newMessages.length)}}return t.prototype.hasUnread=function(t){return P(this,void 0,void 0,(function(){var e,n;return C(this,(function(r){for(e=0,n=t.get();e<n.length;e++)if(n[e].unread.get())return[2,!0];return[2,!1]}))}))},t.prototype.getMessageParticipantInfoList=function(t){return P(this,void 0,void 0,(function(){var e=this;return C(this,(function(n){return[2,i.o.get("messageParticipantEntryList-".concat(t),(function(){return P(e,void 0,void 0,(function(){var e,n,r,o;return C(this,(function(i){switch(i.label){case 0:return[4,this.loadMessageParticipantInfoList(t)];case 1:return e=i.sent(),this.messageParticipantInfoLists.hasOwnProperty(t)?[4,this.hasUnread(this.messageParticipantInfoLists[t])]:[3,4];case 2:return n=i.sent(),this.messageParticipantInfoLists[t].replace(e),[4,this.hasUnread(this.messageParticipantInfoLists[t])];case 3:return r=i.sent(),n&&!r?(this.studiesWithNewMessagesCount.set(this.studiesWithNewMessagesCount.get()-1),delete this.studiesWithNewMessagesList[t]):!n&&r&&(this.studiesWithNewMessagesCount.set(this.studiesWithNewMessagesCount.get()+1),this.studiesWithNewMessagesList[t]=!0),[3,6];case 4:return o=new g.X(e,null,"messageParticipantEntryList-".concat(t),(function(t,e,n){return new _(t,e,n)})),this.messageParticipantInfoLists[t]=o,[4,this.hasUnread(o)];case 5:i.sent()&&(this.studiesWithNewMessagesCount.set(this.studiesWithNewMessagesCount.get()+1),this.studiesWithNewMessagesList[t]=!0),i.label=6;case 6:return[2,this.messageParticipantInfoLists[t]]}}))}))}))]}))}))},t.prototype.getReloadedMessageParticipantInfoList=function(t){return i.o.remove("messageParticipantEntryList-".concat(t)),this.getMessageParticipantInfoList(t)},t.prototype.getMessageParticipantInfoListOrThrow=function(t){if(!this.messageParticipantInfoLists.hasOwnProperty(t))throw new Error("No messages for ".concat(t,". Were they loaded?"));return this.messageParticipantInfoLists[t]},t.prototype.loadMessageParticipantInfoList=function(t){return P(this,void 0,void 0,(function(){var e;return C(this,(function(n){switch(n.label){case 0:return[4,s.l.loadJson("".concat(o.Zv,"?type=ListUserWithMessages&study_id=").concat(t))];case 1:return(e=n.sent()).sort((function(t,e){return t.lastMsg==e.lastMsg?0:t.lastMsg<e.lastMsg?1:-1})),[2,e]}}))}))},t.prototype.loadMessages=function(t,e){return P(this,void 0,void 0,(function(){return C(this,(function(n){return[2,s.l.loadJson("".concat(o.Zv,"?type=ListMessages&study_id=").concat(t,"&user=").concat(e))]}))}))},t}(),x=function(){function t(t){if(this.studiesWithNewMerlinLogsCount=new N.H(0,null,"studiesWithNewMerlinLogsCount"),this.studiesWithNewMerlinLogsList={},t.newMerlinLogs){for(var e=0,n=t.newMerlinLogs;e<n.length;e++){var r=n[e];this.studiesWithNewMerlinLogsList[r]=!0}this.studiesWithNewMerlinLogsCount.set(t.newMerlinLogs.length)}}return t.prototype.setStudyNewLogsRemaining=function(t,e){this.studiesWithNewMerlinLogsList[t]=e,this.studiesWithNewMerlinLogsCount.set(Object.values(this.studiesWithNewMerlinLogsList).filter((function(t){return t})).length)},t}(),S=n(4862),W=n.n(S),A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},I=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.url=e.primitive("url",""),e.alias=e.primitive("alias",""),e}return A(e,t),e}(a.d),B=function(){function t(){}return t.prototype.init=function(){return E(this,void 0,void 0,(function(){var t=this;return I(this,(function(e){return[2,i.o.get("bookmarsList",(function(){return E(t,void 0,void 0,(function(){var t;return I(this,(function(e){switch(e.label){case 0:return[4,s.l.loadJson("".concat(o.Zv,"?type=GetBookmarks"))];case 1:return t=e.sent(),this.bookmarks=new g.X(t,null,"bookmarksList",(function(t,e,n){return new j(t,e,n)})),this.bookmarks.addObserver((function(t,e){W().redraw()})),[2,this]}}))}))}))]}))}))},t.prototype.getBookmarkIndex=function(t){return this.getBookmarkList().map((function(t){return t.url.get()})).indexOf(t)},t.prototype.isBookmarkListEmpty=function(){return 0==this.bookmarks.get().length},t.prototype.hasBookmark=function(t){return this.getBookmarkIndex(t)>=0},t.prototype.getBookmarkList=function(){var t,e;return null!==(e=null===(t=this.bookmarks)||void 0===t?void 0:t.get())&&void 0!==e?e:[]},t.prototype.deleteBookmark=function(t){return E(this,void 0,void 0,(function(){return I(this,(function(e){switch(e.label){case 0:return[4,s.l.loadJson("".concat(o.Zv,"?type=DeleteBookmark"),"post","url=".concat(t))];case 1:if(e.sent()!=t)throw new Error(m.J.get("error_unknown"));return this.bookmarks.remove(this.getBookmarkIndex(t)),[2]}}))}))},t.prototype.setBookmark=function(t,e){return E(this,void 0,void 0,(function(){var n,r,i;return I(this,(function(a){switch(a.label){case 0:return n=this.bookmarks,[4,s.l.loadJson("".concat(o.Zv,"?type=SetBookmark"),"post","url=".concat(t,"&alias=").concat(e))];case 1:return r=a.sent(),(i=this.getBookmarkIndex(t))>=0?n.get()[i].alias.set(e):n.push(r),[2]}}))}))},t}(),J=function(){function t(t){this.settingsLoader=new d,this.accountsLoader=new L,this.hasErrors=!1,this.isAdmin=!1,this.canCreate=!1,this.accountName="",this.hasErrors=t.hasErrors,this.messagesLoader=new O(t),this.merlinLogsLoader=new x(t),this.bookmarksLoader=new B,this.accountName=t.accountName,this.canCreate=t.canCreate,t.isAdmin?(this.isAdmin=!0,this.permissions={publish:[],msg:[],read:[],write:[]},this.freeDiskSpace=t.freeDiskSpace,this.totalDiskSpace=t.totalDiskSpace):(this.isAdmin=!1,this.permissions=t.permissions,this.freeDiskSpace=0,this.totalDiskSpace=0)}return t.prototype.hasPermission=function(t,e){var n,r;return this.isAdmin||-1!=(null!==(r=null===(n=this.permissions[t])||void 0===n?void 0:n.indexOf(e))&&void 0!==r?r:-1)},t}()}}]);
//# sourceMappingURL=8778.02097fc111c29c2e1478.js.map