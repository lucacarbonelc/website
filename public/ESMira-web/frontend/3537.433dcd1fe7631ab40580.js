"use strict";(self.webpackChunkESMira=self.webpackChunkESMira||[]).push([[3537],{3537:(t,e,n)=>{n.r(e),n.d(e,{Content:()=>k});var r,o=n(7097),i=n(4862),a=n.n(i),s=n(9700),l=n(8819),c=n(2843),u=n(9619),d=n(5491),h=n(9272);!function(t){t[t.skipped=0]="skipped",t[t.empty=1]="empty",t[t.timestamp=2]="timestamp",t[t.image=3]="image",t[t.audio=4]="audio"}(r||(r={}));var p,v=n(45),m=n(6471),f=n(3087),y=(p=function(t,e){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},p(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),g=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{l(r.next(t))}catch(t){i(t)}}function s(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}l((r=r.apply(t,e||[])).next())}))},w=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},b=function(){function t(){this.columnIndex=0,this.disabledValues={},this.checkedCount=0,this.isAllUnchecked=!0,this.updateTableContent=function(){}}return t.prototype.oncreate=function(t){var e;return g(this,void 0,void 0,(function(){var n,r,o,i=this;return w(this,(function(s){switch(s.label){case 0:return n=t.attrs.columnName,this.updateTableContent=t.attrs.updateTableContent,this.csvLoader=t.attrs.csvLoader,this.showFilterForHeader=t.attrs.showFilterForHeader,this.columnIndex=null===(e=this.csvLoader)||void 0===e?void 0:e.getColumnNum(n),[4,this.csvLoader.getValueListInfo(n,!1,!0)];case 1:return r=s.sent(),this.valueListInfo=r,o=!0,r.forEach((function(t){t.visible||(i.disabledValues[t.name]=!0,o=!1)})),this.isAllUnchecked=o,a().redraw(),[2]}}))}))},t.prototype.toggleAll=function(){var t,e,n,r,o,i;return g(this,void 0,void 0,(function(){var a,s,l,c,u,d,h,p;return w(this,(function(v){switch(v.label){case 0:if(!this.isAllUnchecked)return[3,5];if(!(a=this.valueListInfo))return[2];s=a.length-1,v.label=1;case 1:return s>=0?(l=a[s],this.disabledValues[l.name]=!0,[4,null===(t=this.csvLoader)||void 0===t?void 0:t.filterByValue(!1,this.columnIndex,l.name)]):[3,4];case 2:v.sent(),v.label=3;case 3:return--s,[3,1];case 4:return this.checkedCount=null!==(n=null===(e=this.valueListInfo)||void 0===e?void 0:e.length)&&void 0!==n?n:0,this.isAllUnchecked=!1,null===(r=this.showFilterForHeader)||void 0===r||r.set(!0),[3,10];case 5:for(d in c=this.disabledValues,u=[],c)u.push(d);h=0,v.label=6;case 6:return h<u.length?(d=u[h])in c?(p=d,delete this.disabledValues[p],[4,null===(o=this.csvLoader)||void 0===o?void 0:o.filterByValue(!0,this.columnIndex,p)]):[3,8]:[3,9];case 7:v.sent(),v.label=8;case 8:return h++,[3,6];case 9:this.checkedCount=0,this.isAllUnchecked=!0,null===(i=this.showFilterForHeader)||void 0===i||i.set(!1),v.label=10;case 10:return this.updateTableContent(),[2]}}))}))},t.prototype.toggleFilter=function(t){var e,n,r;return g(this,void 0,void 0,(function(){var o;return w(this,(function(i){switch(i.label){case 0:return(o=this.disabledValues.hasOwnProperty(t))?(--this.checkedCount,delete this.disabledValues[t],0==this.checkedCount&&(null===(e=this.showFilterForHeader)||void 0===e||e.set(!1))):(++this.checkedCount,this.disabledValues[t]=!0,1==this.checkedCount&&(null===(n=this.showFilterForHeader)||void 0===n||n.set(!0))),[4,null===(r=this.csvLoader)||void 0===r?void 0:r.filterByValue(o,this.columnIndex,t)];case 1:return i.sent(),this.updateTableContent(),[2]}}))}))},t.prototype.view=function(){var t=this,e=this.valueListInfo;return null==e?a()("div",{class:"center"},(0,h.k)()):a()("div",null,(0,d.p)((function(n){return a()("div",null,a()("input",{class:"search small vertical",type:"text",onkeyup:n.updateSearchFromEvent.bind(n)}),a()("label",null,a()("input",{type:"checkbox",onchange:t.toggleAll.bind(t),checked:t.isAllUnchecked}),a()("span",{class:"smallText"},s.J.get("toggle_all",e.length))),e.map((function(e){return n.searchView(e.name,a()("label",{class:"line noTitle noDesc"},a()("input",{type:"checkbox",onchange:t.toggleFilter.bind(t,e.name),checked:!t.disabledValues.hasOwnProperty(e.name)}),a()("span",{class:"smallText"},e.totalCount===e.count?"".concat(e.name," (").concat(e.totalCount,")"):"".concat(e.name," (").concat(e.count,"/").concat(e.totalCount,")"))))})))})))},t}(),C=function(){function t(){this.filterParentObservable=new f.H(!1,null,"filterParentObservable"),this.shownHeaderNames=[],this.showFilterForHeaderArray=[],this.userIdColumnNum=0,this.entryIdColumnNum=0,this.columnWidths=[],this.maxElementsDisplayed=0,this.lastScrollY=0,this.markedRowsNum=0,this.studyId=0}return t.prototype.scrollUpdate=function(){var t,e;return g(this,void 0,void 0,(function(){var n;return w(this,(function(r){switch(r.label){case 0:return(n=null!==(e=null===(t=this.scrollRoot)||void 0===t?void 0:t.scrollTop)&&void 0!==e?e:0)===this.lastScrollY?[3,2]:[4,this.updateTableContent()];case 1:r.sent(),r.label=2;case 2:return this.lastScrollY=n,[2]}}))}))},t.prototype.updateVisibleRowNum=function(){var t,e;this.maxElementsDisplayed=Math.floor((null!==(e=null===(t=this.scrollRoot)||void 0===t?void 0:t.clientHeight)&&void 0!==e?e:0)/25-1)},t.prototype.markRow=function(t,e){var n,r;return g(this,void 0,void 0,(function(){return w(this,(function(o){switch(o.label){case 0:return e.classList.contains("marked")?(e.classList.remove("marked"),[4,null===(n=this.csvLoader)||void 0===n?void 0:n.mark(!1,t.arrayIndex)]):[3,2];case 1:return o.sent(),t.marked=!1,--this.markedRowsNum,[3,4];case 2:return e.classList.add("marked"),[4,null===(r=this.csvLoader)||void 0===r?void 0:r.mark(!0,t.arrayIndex)];case 3:o.sent(),t.marked=!0,++this.markedRowsNum,o.label=4;case 4:return this.markedRowsInfoView&&(this.markedRowsNum?(this.markedRowsInfoView.innerText=s.J.get("selected_rows_x",this.markedRowsNum),this.markedRowsInfoView.classList.remove("hidden")):this.markedRowsInfoView.classList.add("hidden")),[2]}}))}))},t.prototype.createTrView=function(t){var e=this,n=document.createElement("tr"),o=this.csvLoader;if(!o)return n;n.style.cssText="height:".concat(25,"px"),t.marked&&n.classList.add("marked"),n.addEventListener("click",this.markRow.bind(this,t,n));var i=document.createElement("th");return i.innerText=(t.shownIndex+1).toString(),n.appendChild(i),t.columnCells.forEach((function(i,a){var c,d=null;switch(i.specialType){case r.timestamp:(c=document.createElement("td")).style.cssText="font-style: italic";var h=document.createElement("div");h.classList.add("prettyValue"),h.innerText=i.value,c.appendChild(h);var p=document.createElement("div");p.classList.add("realValue"),p.innerText=i.realValue,c.appendChild(p),(d=document.createElement("div")).classList.add("center"),d.innerText="".concat(i.value,"\n").concat(s.J.getWithColon("timestamp")," ").concat(i.realValue);break;case r.image:var v=l.h6.replace("%1",e.studyId.toString()).replace("%2",t.columnCells[e.userIdColumnNum].value).replace("%3",t.columnCells[e.entryIdColumnNum].value).replace("%4",o.headerNames[a]);(c=document.createElement("td")).style.cssText="font-style: italic";var m=document.createElement("a");m.href=v,m.target="_blank",m.innerText=i.value,(0,u.FV)("dataImage",m,(function(){var t=document.createElement("img");return t.src=v,t}),{eventName:"mouseenter"}),m.addEventListener("mouseleave",(function(){(0,u.qX)("dataImage")})),c.appendChild(m);var f=document.createElement("img");f.style.cssText="max-width: 500px; max-height: 500px;",f.src=v;break;case r.audio:var y=l.ky.replace("%1",e.studyId.toString()).replace("%2",t.columnCells[e.userIdColumnNum].value).replace("%3",t.columnCells[e.entryIdColumnNum].value).replace("%4",o.headerNames[a]);(c=document.createElement("td")).style.cssText="font-style: italic";var g=document.createElement("a");g.href=y,g.target="_blank",g.innerText=i.value,c.appendChild(g);break;case r.empty:(c=document.createElement("td")).style.cssText="font-style: italic",c.innerText=i.value;break;case r.skipped:return;default:(c=document.createElement("td")).innerText=i.value}null!=d&&((0,u.FV)("dataHoverInfo",c,(function(){return d}),{eventName:"mouseenter"}),c.addEventListener("mouseleave",(function(){(0,u.qX)("dataHoverInfo")}))),n.appendChild(c)})),n},t.prototype.emptyTableContent=function(){for(var t;null===(t=this.tableContent)||void 0===t?void 0:t.hasChildNodes();)this.tableContent.removeChild(this.tableContent.firstChild)},t.prototype.updateTableContent=function(){var t,e;return g(this,void 0,void 0,(function(){var n,r,o,i,a=this;return w(this,(function(s){switch(s.label){case 0:return(n=this.csvLoader)?(r=Math.min(n.visibleRowsCount,Math.ceil((null!==(e=null===(t=this.scrollRoot)||void 0===t?void 0:t.scrollTop)&&void 0!==e?e:0)/25)+this.maxElementsDisplayed-1),[4,n.getVisibleRows(Math.max(r-this.maxElementsDisplayed+1,0),r+1)]):[2,Promise.resolve()];case 1:return o=s.sent(),this.heightViewForScrollbar&&(this.heightViewForScrollbar.style.height="".concat(25*(n.visibleRowsCount+1),"px")),(i=this.tableContent)?(this.emptyTableContent(),o.forEach((function(t){i.appendChild(a.createTrView(t))})),[2]):[2]}}))}))},t.prototype.getHeaderDropDown=function(t,e,n){return a()(b,{updateTableContent:this.updateTableContent.bind(this),csvLoader:t,columnName:e,showFilterForHeader:this.showFilterForHeaderArray[n]})},t.prototype.view=function(t){var e,n=this,r=t.attrs.csvLoader;return a()("div",{class:"dataContainer"},a()("div",{class:"heightViewForScrollbar"}),a()("table",{class:"dataTable"},a()("thead",{class:"dataHeader"},a()("th",{style:"min-width: ".concat(null!==(e=this.columnWidths[0])&&void 0!==e?e:0,"px")}),this.shownHeaderNames.map((function(t,e){var o;return(0,u.rI)("dataHeaderMenu",a()("th",{style:"min-width: ".concat(null!==(o=n.columnWidths[e+1])&&void 0!==o?o:0,"px")},a()("span",{class:n.showFilterForHeaderArray[e].get()?"highlight clickable":"clickable",style:"height: ".concat(25,"px")},t)),(function(){return n.getHeaderDropDown(r,t,e)}))}))),a()("tbody",{class:"dataContent"})),a()("pre",{class:"markedRowsInfoView hidden smallText highlight infoSticker"}))},t.prototype.oncreate=function(t){return g(this,void 0,void 0,(function(){var e,n,r,o,i,s,l,c,u,d,h=this;return w(this,(function(p){switch(p.label){case 0:for(this.studyId=t.attrs.studyId,this.csvLoader=t.attrs.csvLoader,this.scrollRoot=t.dom,this.tableContent=t.dom.getElementsByClassName("dataContent")[0],this.heightViewForScrollbar=t.dom.getElementsByClassName("heightViewForScrollbar")[0],this.markedRowsInfoView=t.dom.getElementsByClassName("markedRowsInfoView")[0],this.userIdColumnNum=this.csvLoader.hasColumn("userId")?this.csvLoader.getColumnNum("userId"):0,this.entryIdColumnNum=this.csvLoader.hasColumn("userId")?this.csvLoader.getColumnNum("entryId"):0,e={},n=0,r=v.iK;n<r.length;n++)o=r[n],e[o]=!0;for(i=0,s=this.csvLoader.headerNames;i<s.length;i++)l=s[i],e.hasOwnProperty(l)||(this.shownHeaderNames.push(l),this.showFilterForHeaderArray.push(new f.H(!1,this.filterParentObservable,l)));return this.scrollRoot.addEventListener("scroll",this.scrollUpdate.bind(this)),this.updateVisibleRowNum(),[4,this.updateTableContent()];case 1:return p.sent(),t.dom.getElementsByClassName("dataHeader")[0].childNodes.forEach((function(t){var e=t;h.columnWidths.push(e.offsetWidth)})),c=t.attrs.filterKey,u=t.attrs.filterValue,c&&u&&this.csvLoader?[4,this.csvLoader.filterEntireColumn(!1,c)]:[3,5];case 2:return p.sent(),[4,this.csvLoader.filterByValue(!0,c,u)];case 3:return p.sent(),[4,this.updateTableContent()];case 4:p.sent(),d=this.csvLoader.getColumnNum(c),this.showFilterForHeaderArray[d].set(!0),p.label=5;case 5:return this.filterParentObservable.addObserver((function(){return a().redraw()})),a().redraw(),[2]}}))}))},t.prototype.onupdate=function(){this.updateVisibleRowNum()},t.prototype.onremove=function(){(0,u.qX)("dataHoverInfo")},t}(),k=function(t){function e(e,n){var r=t.call(this,e)||this;return r.csvLoader=n,r}return y(e,t),e.preLoad=function(t){return window.Worker?"logins"===t.sectionValue?[c.I.fromUrl(t.loader,"".concat(l.Zv,"?type=GetLoginHistory"))]:[t.getStudyPromise().then((function(e){var n,r=e.id.get(),o=null!==(n=t.getStaticString("questionnaire"==t.sectionValue?"qId":"file"))&&void 0!==n?n:"error";return c.I.fromUrl(t.loader,l.WW.replace("%1",r.toString()).replace("%2",o),e.getInputNamesPerType())}))]:(t.loader.error(s.J.get("error_no_webWorkers")),[])},e.prototype.titleExtra=function(){return(0,m.C9)(this.section.reload.bind(this.section),s.J.get("reload"))},e.prototype.title=function(){var t,e,n,r,o,i="(".concat(s.J.get("entry_count",this.csvLoader.visibleRowsCount),")");switch(this.section.sectionValue){case"logins":return s.J.get("login_history");case"questionnaire":return"".concat(this.getQuestionnaireOrThrow().getTitle(),".csv ").concat(i);case"backup":var a=null!==(t=this.getStaticString("file"))&&void 0!==t?t:"",l=null!==(e=a.match(/^(\d{4}-\d{2}-\d{2})_(\d+)$/))&&void 0!==e?e:[],c=l[0],u=l[1],d=l[2];return c?"".concat(u," ").concat(null!==(r=null===(n=this.getQuestionnaireOrNull(parseInt(d)))||void 0===n?void 0:n.getTitle())&&void 0!==r?r:d," ").concat(i):a;default:return"".concat(null!==(o=this.getStaticString("file"))&&void 0!==o?o:s.J.get("error_unknown")," ").concat(i)}},e.prototype.getView=function(){var t,e=this.getStaticString("filter"),n=null!==(t=this.getStaticInt("id"))&&void 0!==t?t:-1;if(e){var r=this.getStaticString(e);if(r)return a()(C,{csvLoader:this.csvLoader,studyId:n,filterKey:e,filterValue:atob(r)})}return a()(C,{csvLoader:this.csvLoader,studyId:n})},e}(o.R)},7097:(t,e,n)=>{n.d(e,{R:()=>r});var r=function(){function t(t){this.section=t}return t.preLoad=function(t){return[]},t.prototype.preInit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.resolve()},t.prototype.hasAlternatives=function(){return!1},t.prototype.getAlternatives=function(){return null},t.prototype.titleExtra=function(){return null},t.prototype.getDynamic=function(t,e){return this.section.getDynamic(t,e)},t.prototype.setDynamic=function(t,e){this.section.siteData.dynamicValues.setChild(t,e)},t.prototype.getStaticInt=function(t){return this.section.getStaticInt(t)},t.prototype.getStaticString=function(t){return this.section.getStaticString(t)},t.prototype.getStudyOrNull=function(t){var e,n;void 0===t&&(t=null!==(e=this.getStaticInt("id"))&&void 0!==e?e:-1);var r=this.section.siteData.studyLoader.getStudies();return-1==t?1==r.getCount()&&r.getFirst()||null:null!==(n=r.getEntry(t))&&void 0!==n?n:null},t.prototype.getStudyOrThrow=function(t){var e;void 0===t&&(t=null!==(e=this.getStaticInt("id"))&&void 0!==e?e:-1);var n=this.getStudyOrNull(t);if(!n)throw new Error("Study ".concat(t," does not exist!"));return n},t.prototype.getQuestionnaireOrNull=function(t,e){var n;if(void 0===t&&(t=null!==(n=this.getStaticInt("qId"))&&void 0!==n?n:-1),void 0===e&&(e=this.getStudyOrNull()),!e)return null;for(var r=0,o=this.getStudyOrThrow().questionnaires.get();r<o.length;r++){var i=o[r];if(i.internalId.get()==t)return i}return null},t.prototype.getQuestionnaireOrThrow=function(t){var e;void 0===t&&(t=null!==(e=this.getStaticInt("qId"))&&void 0!==e?e:-1);var n=this.getQuestionnaireOrNull(t,this.getStudyOrThrow());if(n)return n;throw new Error("Questionnaire ".concat(t," does not exist!"))},t.prototype.getTools=function(){return this.section.getTools()},t.prototype.getAdmin=function(){return this.section.getAdmin()},t.prototype.hasPermission=function(t,e){var n;return this.getAdmin().isLoggedIn()&&null!==(n=this.getTools().hasPermission(t,e))&&void 0!==n&&n},t.prototype.getUrl=function(t,e){return void 0===e&&(e=this.section.depth),"".concat(this.section.getHash(e),"/").concat(t)},t.prototype.goTo=function(t){window.location.hash="#"+t},t.prototype.newSection=function(t,e){void 0===e&&(e=this.section.depth),window.location.hash=-1==e?t:"".concat(this.section.getHash(e),"/").concat(t)},t.prototype.destroy=function(){},t}()},5491:(t,e,n)=>{n.d(e,{p:()=>a});var r=n(4862),o=n.n(r),i=function(){function t(){this.currentSearchValue=""}return t.prototype.updateSearch=function(t){this.currentSearchValue=t},t.prototype.updateSearchFromEvent=function(t){this.updateSearch(t.target.value)},t.prototype.searchView=function(t,e){return-1!=t.search(this.currentSearchValue)?e:null},t.prototype.view=function(t){var e,n,r=t.attrs.content(this);return r.attrs.className="".concat(null!==(e=t.attrs.className)&&void 0!==e?e:""," ").concat(null!==(n=r.attrs.className)&&void 0!==n?n:""),r},t}();function a(t){return o()(i,{content:t})}}}]);
//# sourceMappingURL=3537.433dcd1fe7631ab40580.js.map