"use strict";(self.webpackChunkESMira=self.webpackChunkESMira||[]).push([[7130],{3858:(t,e,r)=>{r.d(e,{p:()=>u});var n=r(8819),i=r(1818),o=r(2843),a=r(6002),s=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function s(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},c=function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},u=function(){function t(t,e){this.variableGroupIndex={},this.personalStatistics={},this.csvLoaders={},this.charts=[],this.needsPublicStatistics=!1,this.loaderState=t,this.study=e,this.urlTemplate=n.WW.replace("%1",e.id.get().toString())}return t.prototype.setupLoadersForCharts=function(t){return s(this,void 0,void 0,(function(){var e,r,n,o,a,s,u=this;return c(this,(function(c){switch(c.label){case 0:for(this.charts=t,e=this.study.questionnaires.get(),r=function(t){var r=e[t];i.Y.getQuestionnaireVariables(r).forEach((function(e){u.variableGroupIndex[e]=t}))},n=e.length-1;n>=0;--n)r(n);o=0,a=this.charts,c.label=1;case 1:return o<a.length?(s=a[o],[4,this.checkAxis(s.axisContainer.get())]):[3,5];case 2:return c.sent(),s.displayPublicVariable.get()?[4,this.checkAxis(s.publicVariables.get())]:[3,4];case 3:c.sent(),c.label=4;case 4:return o++,[3,1];case 5:return[2]}}))}))},t.prototype.checkAxis=function(t){return s(this,void 0,void 0,(function(){var e,r,n,i,o;return c(this,(function(a){switch(a.label){case 0:e=0,r=t,a.label=1;case 1:return e<r.length?(n=r[e],i=n.xAxis,o=n.yAxis,[4,this.addLoader(i.variableName.get())]):[3,5];case 2:return a.sent(),[4,this.addLoader(o.variableName.get())];case 3:a.sent(),a.label=4;case 4:return e++,[3,1];case 5:return[2]}}))}))},t.prototype.addLoader=function(t){return s(this,void 0,void 0,(function(){var e,r,n,i;return c(this,(function(a){switch(a.label){case 0:return t?(e=this.variableGroupIndex[t],this.csvLoaders[e]?[3,2]:(r=this.urlTemplate.replace("%2",this.study.questionnaires.get()[e].internalId.get().toString()),n=this.csvLoaders,i=e,[4,o.I.fromUrl(this.loaderState,r)])):[2];case 1:n[i]=a.sent(),a.label=2;case 2:return[2]}}))}))},t.prototype.combineStatistics=function(t){var e=function(e){var n=t[e];if(r.personalStatistics.hasOwnProperty(e)){var i=r.personalStatistics[e];n.forEach((function(t,e){i[e]&&0==t.entryCount||(i[e]=t)}))}else r.personalStatistics[e]=n},r=this;for(var n in t)e(n)},t.prototype.addStatistics=function(t){return s(this,void 0,void 0,(function(){var e,r,n,i;return c(this,(function(o){switch(o.label){case 0:e=0,r=this.charts,o.label=1;case 1:return e<r.length?(n=r[e],[4,t.getStatistics(n.axisContainer.get(),n.dataType.get())]):[3,4];case 2:i=o.sent(),this.combineStatistics(i),n.displayPublicVariable.get()&&(this.needsPublicStatistics=!0),o.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},t.prototype.loadStatisticsFromFiles=function(t,e){return void 0===e&&(e=!1),s(this,void 0,void 0,(function(){var r,i,o,s,u,l,h,p,d;return c(this,(function(c){switch(c.label){case 0:for(o in r=this.csvLoaders,i=[],r)i.push(o);s=0,c.label=1;case 1:return s<i.length?(o=i[s])in r?(u=o,l=this.csvLoaders[u],t?[4,l.filterEntireColumn(!1,"userId")]:[3,4]):[3,6]:[3,7];case 2:return c.sent(),[4,l.filterByValue(!0,"userId",t)];case 3:c.sent(),c.label=4;case 4:return[4,this.addStatistics(l)];case 5:c.sent(),c.label=6;case 6:return s++,[3,1];case 7:return!this.needsPublicStatistics||e?[3,10]:this.publicStatistics?[3,9]:(h=this.study.accessKeys.get(),p=h.length?h[0].get():"",d=this,[4,a.l.loadJson(n.De.replace("%d",this.study.id.get().toString()).replace("%s",p))]);case 8:d.publicStatistics=c.sent(),c.label=9;case 9:return[2,{mainStatistics:this.personalStatistics,additionalStatistics:this.publicStatistics}];case 10:return[2,{mainStatistics:this.personalStatistics}]}}))}))},t}()},1896:(t,e,r)=>{r.d(e,{B:()=>a});var n,i=r(3125),o=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=function(t){function e(e,r,n){var i=t.call(this,r,n)||this;return i.keyName=n,i.backingField=e,i}return o(e,t),e.prototype.reCalcIsDifferent=function(t){void 0===t&&(t=!1)},e.prototype.createJson=function(){return""},e.prototype.isDifferent=function(){return!1},e.prototype.get=function(){return this.backingField},e.prototype.set=function(t,e){void 0===e&&(e=!1),this.backingField=t,e||this.hasMutated(!0,!0)},e.prototype.setValue=function(t,e){void 0===e&&(e=!1),this.set(Promise.resolve(t),e)},e}(i.Z)},7130:(t,e,r)=>{r.r(e),r.d(e,{Content:()=>d});var n,i=r(7097),o=r(9700),a=r(9966),s=r(3858),c=r(2416),u=r(1896),l=r(2843),h=r(6471),p=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),d=function(t){function e(e,r){var n=t.call(this,e)||this;if(!(r&&r.sectionContent instanceof a.ChartEditSectionContent))throw new Error("Could not find a proper chartEdit section");return n.connectedSection=r.sectionContent,n.randomContent="calc"!=r.sectionValue,n.csvLoaderCollection=new s.p(e.loader,n.getStudyOrThrow()),n.promise=new u.B(n.loadStatistics(),null,"chartPreview"),n.chartObserverId=n.connectedSection.getChart().addObserver((function(){n.promise.set(n.loadStatistics())})),n}return p(e,t),e.preLoad=function(t){for(var e=void 0,r=t.allSections,n=t.depth-1;n>0;--n){var i=r[n];if("chartEdit"==i.sectionName){e=i;break}}if(!e)throw new Error("Could not find a proper chartEdit section");return[e.initPromise,t.getStudyPromise()]},e.prototype.title=function(){return o.J.get(this.randomContent?"preview":"calculate")},e.prototype.titleExtra=function(){var t=this;return(0,h.C9)((function(){return t.promise.set(t.loadStatistics())}),o.J.get("reload"))},e.prototype.loadStatistics=function(){return t=this,e=void 0,n=function(){var t,e,r;return function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(n){switch(n.label){case 0:return this.randomContent?(t=this.connectedSection.getChart(),[4,l.I.fromCsv(this.section.loader,this.createRandomCsv())]):[3,4];case 1:return e=n.sent(),r={},[4,e.getStatistics(t.axisContainer.get(),t.dataType.get())];case 2:return r.mainStatistics=n.sent(),[4,e.getStatistics(t.publicVariables.get(),t.dataType.get())];case 3:return[2,(r.additionalStatistics=n.sent(),r)];case 4:return[4,this.csvLoaderCollection.setupLoadersForCharts([this.connectedSection.getChart()])];case 5:return n.sent(),[2,this.csvLoaderCollection.loadStatisticsFromFiles()]}}))},new((r=void 0)||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function s(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}));var t,e,r,n},e.prototype.addRandomValues=function(t,e){void 0===e&&(e=50);for(var r=1;r<e;++r)t.length<=r&&t.push([]),t[r].push(this.getRandomInt(0,10).toString())},e.prototype.addTimeVariables=function(t){for(var e=["uploaded","responseTime"],r=t.length-1,n=1571820812e3,i=0,o=e;i<o.length;i++){var a=o[i];t[0].push(a)}for(var s=1;s<r;++s){for(var c=0,u=e;c<u.length;c++)t[s].push(n.toString());n+=this.getRandomInt(0,432e5)}},e.prototype.fillAxisContainer=function(t,e){var r=t.xAxis.variableName.get();r&&(e[0].push(r),this.addRandomValues(e));var n=t.yAxis.variableName.get();n&&(e[0].push(n),this.addRandomValues(e))},e.prototype.createRandomCsv=function(){for(var t=this.connectedSection.getChart(),e=[[]],r=0,n=t.axisContainer.get();r<n.length;r++){var i=n[r];this.fillAxisContainer(i,e)}for(var o=0,a=t.publicVariables.get();o<a.length;o++)i=a[o],this.fillAxisContainer(i,e);return this.addTimeVariables(e),e},e.prototype.getRandomInt=function(t,e){return void 0===e&&(e=0),Math.floor(Math.random()*(e-t))+t},e.prototype.getView=function(){return(0,c.O)(this.connectedSection.getChart(),this.promise)},e.prototype.destroy=function(){this.chartObserverId.removeObserver(),t.prototype.destroy.call(this)},e}(i.R)},2416:(t,e,r)=>{r.d(e,{O:()=>c});var n=r(4862),i=r.n(n),o=r(8913),a=r(9272),s=function(){function t(){this.enabled=!1}return t.prototype.drawGraph=function(t,e,r){var n,a,s,c,u;return a=this,s=void 0,u=function(){var a,s;return function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(c){switch(c.label){case 0:return this.enabled=!1,i().redraw(),[4,e];case 1:if(a=c.sent(),!(s=this.chartView))return[2];for(;null==s?void 0:s.hasChildNodes();)s.removeChild(s.lastChild);return this.chartViewBox=new o.HN(s,a.mainStatistics,null!==(n=a.additionalStatistics)&&void 0!==n?n:{},t,r),this.enabled=!0,i().redraw(),[2]}}))},new((c=void 0)||(c=Promise))((function(t,e){function r(t){try{i(u.next(t))}catch(t){e(t)}}function n(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){var i;e.done?t(e.value):(i=e.value,i instanceof c?i:new c((function(t){t(i)}))).then(r,n)}i((u=u.apply(a,s||[])).next())}))},t.prototype.oncreate=function(t){var e=this,r=t.attrs.promise,n=t.attrs.chart,i=t.attrs.noSort;this.chart=n,this.chartView=t.dom.getElementsByClassName("chartViewWindow")[0],this.drawGraph(n,r.get(),i),this.promiseObserverId=r.addObserver((function(){e.drawGraph(n,r.get(),i)}))},t.prototype.onupdate=function(t){var e,r=this,n=t.attrs.promise,i=t.attrs.chart,o=t.attrs.noSort;i!=this.chart&&(this.chart=i,this.drawGraph(i,n.get(),o),null===(e=this.promiseObserverId)||void 0===e||e.removeObserver(),this.promiseObserverId=n.addObserver((function(){r.drawGraph(i,n.get(),o)})))},t.prototype.onremove=function(){var t;null===(t=this.promiseObserverId)||void 0===t||t.removeObserver()},t.prototype.view=function(t){var e;return i()("div",{class:"chartView center ".concat(null!==(e=t.attrs.className)&&void 0!==e?e:"")},i()("div",{class:"chartViewWindow ".concat(this.enabled?"fadeIn":"")}),!this.enabled&&(0,a.k)())},t}();function c(t,e,r){return void 0===r&&(r=!1),i()(s,{chart:t,promise:e,noSort:r})}}}]);
//# sourceMappingURL=7130.4a1251df214313188486.js.map