"use strict";(self.webpackChunkESMira=self.webpackChunkESMira||[]).push([[5073],{3001:(t,e,n)=>{n.d(e,{P:()=>g});var i=n(9619),o=n(4862),r=n.n(o),s=n(1883),u=n(8879),c=n(9700),a=n(233),l=n(2570),d=n(145),h=n(9433),p=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{c(i.next(t))}catch(t){r(t)}}function u(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,u)}c((i=i.apply(t,e||[])).next())}))},f=function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(s=0)),s;)try{if(n=1,i&&(o=2&u[0]?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,i=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){s.label=u[1];break}if(6===u[0]&&s.label<o[1]){s.label=o[1],o=u;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(u);break}o[2]&&s.ops.pop(),s.trys.pop();continue}u=e.call(t,s)}catch(t){u=[6,t],i=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}},g=function(){function t(t){this.sectionContent=t}return t.prototype.addStudy=function(t){return p(this,void 0,void 0,(function(){var e,n,o=this;return f(this,(function(r){switch(r.label){case 0:return e=this.sectionContent.section.loader,n=this.sectionContent.section.siteData.studyLoader,[4,this.sectionContent.section.getStrippedStudyListPromise()];case 1:return r.sent(),[4,e.showLoader(n.loadStrippedStudyList())];case 2:return r.sent(),(0,i.kp)("newDialog",t,(function(t){return o.addStudyView((function(i){return p(o,void 0,void 0,(function(){var o;return f(this,(function(r){switch(r.label){case 0:return t(),[4,e.showLoader(n.addStudy(i))];case 1:return(o=r.sent())&&this.sectionContent.newSection("allStudies:edit/studyEdit,id:".concat(o)),[2]}}))}))}))}),{connectedDropdowns:["studyList","newSource"]}),[2]}}))}))},t.prototype.addStudyView=function(t){var e=this,n=this.sectionContent.section.loader,o=this.sectionContent.section.siteData.studyLoader;return r()("div",{class:"content"},(0,s.x)(this.newButton(c.J.get("empty_study"),c.J.get("prompt_studyName"),(function(e){return t({title:e})})),this.duplicateButton(c.J.get("duplicate_study"),(function(i,s){return r()("li",{class:"clickable ".concat(i.published.get()?"":"unPublishedStudy"),onclick:function(){return p(e,void 0,void 0,(function(){var e;return f(this,(function(r){switch(r.label){case 0:return s(),[4,n.showLoader(o.loadFullStudy(i.id.get()))];case 1:return e=r.sent(),t(e.createJson()),[2]}}))}))}},i.title.get())})),(0,i.rI)("newSource",(0,u.B)("stretched",{template:{title:c.J.get("from_study_source")},showAsClickable:!0}),(function(e){return r()("div",{class:"content"},r()(d.$,{setJson:function(n){t(n),e()},showMainMenuBar:!1,mode:h.Kt.text,saveBtnLabel:c.J.get("create")}))}))))},t.prototype.addQuestionnaire=function(t,e){return p(this,void 0,void 0,(function(){var n,o,r=this;return f(this,(function(s){switch(s.label){case 0:return n=this.sectionContent.section.loader,o=this.sectionContent.section.siteData.studyLoader,[4,n.showLoader(o.loadStrippedStudyList())];case 1:return s.sent(),(0,i.kp)("newDialog",e,(function(e){return r.addQuestionnaireView((function(i){return p(r,void 0,void 0,(function(){var r;return f(this,(function(s){switch(s.label){case 0:return e(),[4,n.showLoader(o.addQuestionnaire(t,i))];case 1:return r=s.sent(),"qEdit"==this.sectionContent.section.sectionName?this.sectionContent.newSection("qEdit,q:".concat(r.internalId.get()),this.sectionContent.section.depth-1):this.sectionContent.newSection("qEdit,q:".concat(r.internalId.get())),this.sectionContent.setDynamic("questionnaireIndex",t.questionnaires.get().length-1),[2]}}))}))}))}),{connectedDropdowns:["studyList"]}),[2]}}))}))},t.prototype.addQuestionnaireView=function(t){var e=this,n=this.sectionContent.section.loader,i=this.sectionContent.section.siteData.studyLoader,o={};return r()("div",{class:"content"},(0,s.x)(this.newButton(c.J.get("empty_questionnaire"),c.J.get("prompt_newQuestionnaire"),(function(e){return t({title:e,pages:[{}]})})),this.duplicateButton(c.J.get("duplicate_questionnaire"),(function(s,u){if(0!=s.questionnaires.get().length){var c=s.id.get();return r()("li",{class:"clickable ".concat(s.published.get()?"":"unPublishedStudy"),onclick:function(){return p(e,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,n.showLoader(i.loadFullStudy(c))];case 1:return t.sent(),o[c]=!o[c],[2]}}))}))}},s.title.get(),o[c]&&r()("ul",null,s.questionnaires.get().map((function(o,s){return r()("li",{class:"clickable",onclick:function(){return p(e,void 0,void 0,(function(){var e,o;return f(this,(function(r){switch(r.label){case 0:return u(),[4,n.showLoader(i.loadFullStudy(c))];case 1:return e=r.sent(),o=e.questionnaires.get()[s],t({title:o.getTitle(),pages:o.pages.createJson()}),[2]}}))}))}},o.getTitle())}))))}}))))},t.prototype.newButton=function(t,e,n){return(0,u.B)(null,{template:{title:t,icon:r().trust(a)},onclick:function(){var t=prompt(e);if(!t||t.length<3)return null;n(t)}})},t.prototype.duplicateButton=function(t,e){var n=this,o=this.sectionContent.getTools();return(0,i.rI)("studyList",(0,u.B)(null,{template:{title:t,icon:r().trust(l)},showAsClickable:!0}),(function(t){return r()("ul",{class:"content"},r()("h2",null,c.J.get("select_a_study")),n.sectionContent.section.siteData.studyLoader.getSortedStudyList().filter((function(t){return o.isAdmin||-1!=o.permissions.write.indexOf(t.id.get())})).map((function(n){return e(n,t)})))}))},t}()},145:(t,e,n)=>{n.d(e,{$:()=>u});var i=n(4862),o=n.n(i),r=n(9433),s=n(9700),u=function(){function t(){this.hasChanged=!1}return t.prototype.getJson=function(){return this.getStudy?this.getStudy().createJson():{}},t.prototype.getJsonContent=function(){return this.getStudy?{json:this.getStudy().createJson()}:{text:""}},t.prototype.oncreate=function(t){var e,n,i=this;this.setJson=t.attrs.setJson,this.getStudy=t.attrs.getStudy,this.saveBtnLabel=t.attrs.saveBtnLabel,this.editor=new r.uL({target:t.dom,props:{content:this.getJsonContent(),mode:null!==(e=t.attrs.mode)&&void 0!==e?e:r.Kt.tree,mainMenuBar:null===(n=t.attrs.showMainMenuBar)||void 0===n||n,onChange:function(){i.hasChanged=!0,o().redraw()},onRenderMenu:function(t,e){var n=t.findIndex((function(t){return"table"==(null==t?void 0:t.text)}));return t.splice(n,1),t}}}),this.getStudy&&(this.studyObserveId=this.getStudy().addObserver((function(){var t;null===(t=i.editor)||void 0===t||t.set(i.getJsonContent())})))},t.prototype.onremove=function(){var t;null===(t=this.studyObserveId)||void 0===t||t.removeObserver()},t.prototype.clickApply=function(){var t,e,n;if(this.setJson){var i;try{i=null!==(e=(null===(t=this.editor)||void 0===t?void 0:t.get()).json)&&void 0!==e?e:JSON.parse((null===(n=this.editor)||void 0===n?void 0:n.get()).text)}catch(t){return void console.error(t)}this.getStudy&&(i.id=this.getStudy().id.get()),this.setJson(i),this.hasChanged=!1}},t.prototype.view=function(){var t;return o()("div",{class:"source"},this.hasChanged&&o()("div",{class:"applyBtn",onclick:this.clickApply.bind(this)},null!==(t=this.saveBtnLabel)&&void 0!==t?t:s.J.get("apply_changes")))},t}()},7097:(t,e,n)=>{n.d(e,{R:()=>i});var i=function(){function t(t){this.section=t}return t.preLoad=function(t){return[]},t.prototype.preInit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.resolve()},t.prototype.hasAlternatives=function(){return!1},t.prototype.getAlternatives=function(){return null},t.prototype.titleExtra=function(){return null},t.prototype.getDynamic=function(t,e){return this.section.getDynamic(t,e)},t.prototype.setDynamic=function(t,e){this.section.siteData.dynamicValues.setChild(t,e)},t.prototype.getStaticInt=function(t){return this.section.getStaticInt(t)},t.prototype.getStaticString=function(t){return this.section.getStaticString(t)},t.prototype.getStudyOrNull=function(t){var e,n;void 0===t&&(t=null!==(e=this.getStaticInt("id"))&&void 0!==e?e:-1);var i=this.section.siteData.studyLoader.getStudies();return-1==t?1==i.getCount()&&i.getFirst()||null:null!==(n=i.getEntry(t))&&void 0!==n?n:null},t.prototype.getStudyOrThrow=function(t){var e;void 0===t&&(t=null!==(e=this.getStaticInt("id"))&&void 0!==e?e:-1);var n=this.getStudyOrNull(t);if(!n)throw new Error("Study ".concat(t," does not exist!"));return n},t.prototype.getQuestionnaireOrNull=function(t,e){var n;if(void 0===t&&(t=null!==(n=this.getStaticInt("qId"))&&void 0!==n?n:-1),void 0===e&&(e=this.getStudyOrNull()),!e)return null;for(var i=0,o=this.getStudyOrThrow().questionnaires.get();i<o.length;i++){var r=o[i];if(r.internalId.get()==t)return r}return null},t.prototype.getQuestionnaireOrThrow=function(t){var e;void 0===t&&(t=null!==(e=this.getStaticInt("qId"))&&void 0!==e?e:-1);var n=this.getQuestionnaireOrNull(t,this.getStudyOrThrow());if(n)return n;throw new Error("Questionnaire ".concat(t," does not exist!"))},t.prototype.getTools=function(){return this.section.getTools()},t.prototype.getAdmin=function(){return this.section.getAdmin()},t.prototype.hasPermission=function(t,e){var n;return this.getAdmin().isLoggedIn()&&null!==(n=this.getTools().hasPermission(t,e))&&void 0!==n&&n},t.prototype.getUrl=function(t,e){return void 0===e&&(e=this.section.depth),"".concat(this.section.getHash(e),"/").concat(t)},t.prototype.goTo=function(t){window.location.hash="#"+t},t.prototype.newSection=function(t,e){void 0===e&&(e=this.section.depth),window.location.hash=-1==e?t:"".concat(this.section.getHash(e),"/").concat(t)},t.prototype.destroy=function(){},t}()},233:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>'},2570:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z"/></svg>'}}]);
//# sourceMappingURL=5073.657f2ccf1de05eaf608c.js.map