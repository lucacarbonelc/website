"use strict";(self.webpackChunkESMira=self.webpackChunkESMira||[]).push([[8369],{8369:(t,e,n)=>{n.r(e),n.d(e,{Content:()=>y});var o,r=n(7097),s=n(4862),i=n.n(s),a=n(9700),l=n(6002),c=n(8819),u=n(6969),d=n(8986),p=(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),h=function(t,e,n,o){return new(n||(n=Promise))((function(r,s){function i(t){try{l(o.next(t))}catch(t){s(t)}}function a(t){try{l(o.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}l((o=o.apply(t,e||[])).next())}))},f=function(t,e){var n,o,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},y=function(t){function e(e,n,o){var r=t.call(this,e)||this;return r.reuseFolder=!1,r.folderData=n,r.htaccessEnabled=o.htaccess,r.modRewriteEnabled=o.modRewrite,r}return p(e,t),e.preLoad=function(t){return[l.l.loadJson("".concat(c.Zv,"?type=InitESMiraPrep")),l.l.loadJson(c.P8)]},e.prototype.title=function(){return a.J.get("init_esmira")},e.prototype.changeDataLocation=function(t){return h(this,void 0,void 0,(function(){var e,n;return f(this,(function(o){switch(o.label){case 0:return e=t.target.value,this.folderData.dirBase=e,[4,this.section.loader.loadJson("".concat(c.Zv,"?type=DataFolderExists"),"post","data_location=".concat(e))];case 1:return n=o.sent(),this.folderData.dataFolderExists=n.dataFolderExists,i().redraw(),[2]}}))}))},e.prototype.createESMira=function(t,e){return h(this,void 0,void 0,(function(){return f(this,(function(n){switch(n.label){case 0:return[4,this.section.loader.loadJson("".concat(c.Zv,"?type=InitESMira"),"post","new_account=".concat(t,"&pass=").concat(e,"&data_location=").concat(this.folderData.dirBase,"&reuseFolder=").concat(this.reuseFolder?"1":"0"))];case 1:return n.sent(),this.goTo("admin"),window.location.reload(),[2,!0]}}))}))},e.prototype.getView=function(){var t=this;return i()("div",null,(!this.htaccessEnabled||!this.modRewriteEnabled)&&i()("div",null,(0,u.d)(a.J.getWithColon("additional_server_settings")),i()("div",{class:"spacingBottom"},i().trust(a.J.get("info_init_additional_steps"))),i()("table",{class:"spacingBottom"},i()("tr",null,i()("td",null,".htaccess:"),i()("td",{style:"color:".concat(this.htaccessEnabled?"lightgreen":"red")},this.htaccessEnabled?a.J.get("enabled"):a.J.get("disabled"))),i()("tr",null,i()("td",null,"mod rewrite:"),i()("td",{style:"color:".concat(this.modRewriteEnabled?"lightgreen":"red")},this.modRewriteEnabled?a.J.get("enabled"):a.J.get("disabled"))))),(0,u.d)(a.J.getWithColon("installation_settings")),i()("div",{class:"spacingBottom"},a.J.get("info_path_to_data_directory")),i()("label",{class:"line spacingBottom"},i()("small",null,a.J.get("path_to_data_directory")),i()("input",{class:"big",type:"text",value:this.folderData.dirBase,onchange:this.changeDataLocation.bind(this)})),this.folderData.dataFolderExists&&i()("div",null,i()("div",{class:"spacingBottom"},a.J.get("info_dataFolder_already_exists")),i()("div",{class:"center"},i()("label",null,i()("small",null,a.J.get("no")),i()("input",{type:"radio",checked:!this.reuseFolder,onchange:function(){t.reuseFolder=!1}})),i()("label",{class:"spacingLeft"},i()("small",null,a.J.get("yes")),i()("input",{type:"radio",checked:this.reuseFolder,onchange:function(){t.reuseFolder=!0}})))),(0,u.d)(a.J.getWithColon("admin_account")),i()("div",null,a.J.get("info_no_password_forget")),i()("br",null),i()("br",null),i()("br",null),i()("div",{class:"center"},(0,d.e)(this.createESMira.bind(this),this.section.loader.error.bind(this.section.loader))))},e}(r.R)},7097:(t,e,n)=>{n.d(e,{R:()=>o});var o=function(){function t(t){this.section=t}return t.preLoad=function(t){return[]},t.prototype.preInit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.resolve()},t.prototype.hasAlternatives=function(){return!1},t.prototype.getAlternatives=function(){return null},t.prototype.titleExtra=function(){return null},t.prototype.getDynamic=function(t,e){return this.section.getDynamic(t,e)},t.prototype.setDynamic=function(t,e){this.section.siteData.dynamicValues.setChild(t,e)},t.prototype.getStaticInt=function(t){return this.section.getStaticInt(t)},t.prototype.getStaticString=function(t){return this.section.getStaticString(t)},t.prototype.getStudyOrNull=function(t){var e,n;void 0===t&&(t=null!==(e=this.getStaticInt("id"))&&void 0!==e?e:-1);var o=this.section.siteData.studyLoader.getStudies();return-1==t?1==o.getCount()&&o.getFirst()||null:null!==(n=o.getEntry(t))&&void 0!==n?n:null},t.prototype.getStudyOrThrow=function(t){var e;void 0===t&&(t=null!==(e=this.getStaticInt("id"))&&void 0!==e?e:-1);var n=this.getStudyOrNull(t);if(!n)throw new Error("Study ".concat(t," does not exist!"));return n},t.prototype.getQuestionnaireOrNull=function(t,e){var n;if(void 0===t&&(t=null!==(n=this.getStaticInt("qId"))&&void 0!==n?n:-1),void 0===e&&(e=this.getStudyOrNull()),!e)return null;for(var o=0,r=this.getStudyOrThrow().questionnaires.get();o<r.length;o++){var s=r[o];if(s.internalId.get()==t)return s}return null},t.prototype.getQuestionnaireOrThrow=function(t){var e;void 0===t&&(t=null!==(e=this.getStaticInt("qId"))&&void 0!==e?e:-1);var n=this.getQuestionnaireOrNull(t,this.getStudyOrThrow());if(n)return n;throw new Error("Questionnaire ".concat(t," does not exist!"))},t.prototype.getTools=function(){return this.section.getTools()},t.prototype.getAdmin=function(){return this.section.getAdmin()},t.prototype.hasPermission=function(t,e){var n;return this.getAdmin().isLoggedIn()&&null!==(n=this.getTools().hasPermission(t,e))&&void 0!==n&&n},t.prototype.getUrl=function(t,e){return void 0===e&&(e=this.section.depth),"".concat(this.section.getHash(e),"/").concat(t)},t.prototype.goTo=function(t){window.location.hash="#"+t},t.prototype.newSection=function(t,e){void 0===e&&(e=this.section.depth),window.location.hash=-1==e?t:"".concat(this.section.getHash(e),"/").concat(t)},t.prototype.destroy=function(){},t}()},5617:(t,e,n)=>{n.d(e,{Me:()=>a,Ow:()=>l,WT:()=>i,Xs:()=>u,bo:()=>c});var o=n(3379),r={toAttribute:function(t){return t},toObs:function(t){return t}},s={toAttribute:function(t){return t},toObs:function(t){return parseInt(t)||0}},i=function(){function t(t){this.onBeforeChange=t}return t.prototype.toAttribute=function(t){return t},t.prototype.toObs=function(t,e){return this.onBeforeChange(e.get(),t)||t},t}(),a={toAttribute:function(t){return t?"1":"0"},toObs:function(t){return"1"==t}},l={toAttribute:function(t){var e="number"==typeof t?t:parseInt(t.toString())||0;return 0==e?"":new Date(e).toISOString().split("T")[0]},toObs:function(t){return""===t?0:new Date(t).getTime()}},c={toAttribute:function(t){var e="number"==typeof t?t:parseInt(t.toString())||0;if(-1==e)return"";var n=(0,o.V_)();return(0,o.aP)(n+e)},toObs:function(t){if(""==t)return-1;var e=t.split(":"),n=(0,o.V_)(),r=new Date;return r.setHours(parseInt(e[0])||0),r.setMinutes(parseInt(e[1])||0),r.getTime()-n}};function u(t,e,n,o){var i;void 0===o&&(o="onchange");var a=t.get();return e||(e="number"==typeof a?s:r),n||(n="boolean"==typeof a?"checked":"value"),(i={})[n]=e.toAttribute(a),i[o]=function(o){var r=o.target;t.set(e.toObs(r[n],t))},i}},8986:(t,e,n)=>{n.d(e,{e:()=>f});var o=n(4862),r=n.n(o),s=n(9700),i=n(3087),a=n(5617),l=function(){return l=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},l.apply(this,arguments)},c="background-color: transparent",u="background-color: #ffe1d5",d="background-color: #dfd",p=function(){this.msg="",this.style=c},h=function(){function t(){this.needsAccountName=!1,this.accountName=new i.H("",null,"accountName"),this.password=new i.H("",null,"password"),this.passwordRepeat=new i.H("",null,"passwordRepeat"),this.accountNameStyle=new p,this.passStyle=new p,this.passRepeatStyle=new p,this.formEnabled=!1}return t.prototype.oncreate=function(t){var e=this,n=t.attrs.accountName;this.needsAccountName=!n,n&&this.accountName.set(n),this.accountName.addObserver((function(){e.accountNameStyle=e.lengthCheck(e.accountName.get(),3),e.tryEnableForm()})),this.password.addObserver((function(){e.passStyle=e.lengthCheck(e.password.get(),12),e.tryEnableForm()})),this.passwordRepeat.addObserver((function(){e.passRepeatStyle=e.password.get()!=e.passwordRepeat.get()?{msg:"",style:u}:e.lengthCheck(e.passwordRepeat.get(),12),e.tryEnableForm()}))},t.prototype.lengthCheck=function(t,e){return t.length?t.length<e?{msg:s.J.get("minimal_length",e),style:u}:{msg:"",style:d}:{msg:"",style:c}},t.prototype.tryEnableForm=function(){this.formEnabled=(!this.needsAccountName||this.accountNameStyle.style==d)&&this.passStyle.style==d&&this.passRepeatStyle.style==d},t.prototype.submitForm=function(t,e,n){return o=this,r=void 0,a=function(){return function(t,e){var n,o,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(o){switch(o.label){case 0:return n.preventDefault(),this.accountName.get().length<3?(e(s.J.get("error_short_username")),[3,4]):[3,1];case 1:return this.password.get().length<12?(e(s.J.get("error_bad_password")),[3,4]):[3,2];case 2:return[4,t(this.accountName.get(),this.password.get())];case 3:o.sent()&&(this.needsAccountName&&this.accountName.set(""),this.password.set(""),this.passwordRepeat.set("")),o.label=4;case 4:return[2]}}))},new((i=void 0)||(i=Promise))((function(t,e){function n(t){try{l(a.next(t))}catch(t){e(t)}}function s(t){try{l(a.throw(t))}catch(t){e(t)}}function l(e){var o;e.done?t(e.value):(o=e.value,o instanceof i?o:new i((function(t){t(o)}))).then(n,s)}l((a=a.apply(o,r||[])).next())}));var o,r,i,a},t.prototype.view=function(t){return r()("div",null,r()("form",{method:"post",action:"",class:"nowrap",onsubmit:this.submitForm.bind(this,t.attrs.onFinish,t.attrs.onError)},r()("div",{class:"element"},this.needsAccountName&&r()("label",null,r()("small",null,s.J.get("username")),r()("input",l({autocomplete:"username",type:"text"},(0,a.Xs)(this.accountName),{style:this.accountNameStyle.style})),r()("small",null,this.accountNameStyle.msg))),r()("div",{class:"element"},r()("label",{class:"noDesc"},r()("small",null,s.J.get("password")),r()("input",l({autocomplete:"new-password",type:"password",style:this.passStyle.style},(0,a.Xs)(this.password,void 0,void 0,"onkeyup"))),r()("small",null,this.passStyle.msg)),r()("br",null),r()("label",null,r()("small",null,s.J.get("repeat_password")),r()("input",l({autocomplete:"new-password",type:"password",style:this.passRepeatStyle.style},(0,a.Xs)(this.passwordRepeat,void 0,void 0,"onkeyup"))),r()("small",null,this.passRepeatStyle.msg))),r()("div",{class:"element"},r()("input",{type:"submit",value:t.attrs.btnLabel,disabled:!this.formEnabled}))))},t}();function f(t,e,n,o){return void 0===o&&(o=s.J.get("save")),r()(h,{onFinish:t,onError:e,accountName:n,btnLabel:o})}},6969:(t,e,n)=>{n.d(e,{d:()=>s});var o=n(4862),r=n.n(o);function s(t){var e;return"string"==typeof t?r()("div",{class:"titleRow"},r()("span",{class:"title"},t)):(t.attrs.className="titleRow ".concat(null!==(e=t.attrs.className)&&void 0!==e?e:""),t)}}}]);
//# sourceMappingURL=8369.38e8611f763f6fafedc2.js.map